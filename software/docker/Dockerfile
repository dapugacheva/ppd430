##############################################################################
# USC PPD430 course Dockerfile
#
# Build image from this Dockerfile:
# >>> bash docker-build.sh
#
# Run Jupyter Lab in this container:
# >>> docker run --rm -it -p 8888:8888 -v "$PWD":/home/jovyan/work gboeing/ppd430
##############################################################################

FROM jupyter/base-notebook
LABEL maintainer="Geoff Boeing <boeing@usc.edu>"
LABEL url="https://github.com/gboeing/ppd430"
LABEL description="USC PPD430 course Docker image"

COPY requirements.txt /tmp/

# install packages in one RUN to keep image tidy
RUN mamba update --yes -c conda-forge --strict-channel-priority --no-banner -n base mamba && \
    mamba install --update-all --force-reinstall --yes -c conda-forge --strict-channel-priority --no-banner --file /tmp/requirements.txt && \
    rm -f -r -v /opt/conda/share/jupyter/kernels/python3 && \
    python -m ipykernel install --sys-prefix --name ppd430 --display-name "Python (ppd430)" && \
    mamba clean --all --yes --quiet --no-banner && \
    mamba info --all && \
    mamba list && \
    jupyter kernelspec list && \
    ipython -c "import osmnx; print('OSMnx version', osmnx.__version__)"

# copy default jupyterlab settings, then set jupyter working directory to map to mounted volume
COPY overrides.json /opt/conda/share/jupyter/lab/settings/
WORKDIR /home/jovyan/work

# set default command to launch when container is run
CMD ["jupyter", "lab", "--ip='0.0.0.0'", "--port=8888", "--no-browser", "--NotebookApp.token=''", "--NotebookApp.password=''"]
